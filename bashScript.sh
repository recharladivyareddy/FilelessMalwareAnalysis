memdump="$1"
cd /home/ubuntu/volatility3
sudo python3 vol.py -f /home/ubuntu/"$memdump" windows.pslist|tail -n +5|wc -l >at.txt
sudo python3 vol.py -f /home/ubuntu/"$memdump" windows.pslist | awk '{print $2}' | tail -n +5 | sort | uniq | wc -l>>at.txt
sudo python3 vol.py -f /home/ubuntu/"$memdump" windows.pslist| awk '{print $5}' |tail -n +5 | awk '{s+=$1} END {print s/NR}'>>at.txt
nh=$(sudo python3 vol.py -f /home/ubuntu/"$memdump" windows.handles|tail -n +5|wc -l);np=$(sudo python3 vol.py -f /home/ubuntu/"$memdump" windows.pslist |tail -n +5| wc -l);echo " $nh $np "|awk '{printf "%.2f\n",$1/$2}' >>at.txt
sudo python3 vol.py -f /home/ubuntu/"$memdump" windows.dlllist|tail -n +5|wc -l >>at.txt
np=$(sudo python3 vol.py -f /home/ubuntu/"$memdump" windows.pslist |tail -n +5| wc -l);dll=$(sudo python3 vol.py -f /home/ubuntu/"$memdump" windows.dlllist |tail -n +5| wc -l);echo " $dll $np "|awk '{printf "%.2f\n",$1/$2}' >>at.txt
sudo python3 vol.py -f /home/ubuntu/"$memdump" windows.handles|tail -n +5|wc -l >>at.txt
sudo python3 vol.py -f /home/ubuntu/"$memdump" windows.handles| awk '{print $5}' |grep File |tail -n +5|wc -l >>at.txt
sudo python3 vol.py -f /home/ubuntu/"$memdump" windows.handles| awk '{print $5}' |grep Event |tail -n +5|wc -l >>at.txt
sudo python3 vol.py -f /home/ubuntu/"$memdump" windows.handles| awk '{print $5}' |grep Desktop |tail -n +5|wc -l >>at.txt
sudo python3 vol.py -f /home/ubuntu/"$memdump" windows.handles| awk '{print $5}' |grep Key |tail -n +5|wc -l >>at.txt
sudo python3 vol.py -f /home/ubuntu/"$memdump" windows.handles| awk '{print $5}' |grep Thread |tail -n +5|wc -l>>at.txt
sudo python3 vol.py -f /home/ubuntu/"$memdump" windows.handles| awk '{print $5}' |grep Directory |tail -n +5|wc -l>>at.txt
sudo python3 vol.py -f /home/ubuntu/"$memdump" windows.handles| awk '{print $5}' |grep Semaphore |tail -n +5|wc -l >>at.txt
sudo python3 vol.py -f /home/ubuntu/"$memdump" windows.handles| awk '{print $5}' |grep Timer |tail -n +5|wc -l >>at.txt
sudo python3 vol.py -f /home/ubuntu/"$memdump" windows.handles| awk '{print $5}' |grep Section |tail -n +5|wc -l >>at.txt
sudo python3 vol.py -f /home/ubuntu/"$memdump" windows.handles| awk '{print $5}' |grep Mutant |tail -n +5|wc -l >>at.txt
sudo python3 vol.py -f /home/ubuntu/"$memdump" windows.ldrmodules| awk '{print $4}'| grep -e "False"  | wc -l >>at.txt
sudo python3 vol.py -f /home/ubuntu/"$memdump" windows.ldrmodules| awk '{print $5}'| grep -e "False"  | wc -l>>at.txt
sudo python3 vol.py -f /home/ubuntu/"$memdump" windows.ldrmodules| awk '{print $6}'| grep -e "False"  | wc -l>>at.txt
sudo python3 vol.py -f /home/ubuntu/"$memdump" windows.malfind|grep ".exe"|wc -l>>at.txt
sudo python3 vol.py -f /home/ubuntu/"$memdump" windows.modules|awk '{print $4}'|tail -n +5|sort|uniq|wc -l>>at.txt  
sudo mv at.txt /home/ubuntu/volatility2
cd ..
cd volatility2
profiles=($(sudo ./vol -f /home/ubuntu/"$memdump" imageinfo | grep "Suggested Profile(s)" | awk -F " : " '{print $2}' | tr ',' '\n'))
sudo ./vol -f /home/ubuntu/"$memdump" --profile="${profiles[0]}" psxview|awk '{print $4}'|grep 'False'|wc -l >>at.txt
sudo ./vol -f /home/ubuntu/"$memdump" --profile="${profiles[0]}" psxview|awk '{print $2}'|grep '*'|wc -l >>at.txt
sudo ./vol -f /home/ubuntu/"$memdump" --profile="${profiles[0]}" psxview|awk '{print $6}'|grep 'False'|wc -l >>at.txt
sudo ./vol -f /home/ubuntu/"$memdump" --profile="${profiles[0]}" psxview|awk '{print $7}'|grep 'False'|wc -l>>at.txt
sudo ./vol -f /home/ubuntu/"$memdump" --profile="${profiles[0]}" psxview|awk '{print $8}'|grep 'False'|wc -l>>at.txt
sudo ./vol -f /home/ubuntu/"$memdump" --profile="${profiles[0]}" psxview|awk '{print $9}'|grep 'False'|wc -l>>at.txt
sudo ./vol -f /home/ubuntu/"$memdump" --profile="${profiles[0]}" psxview|awk '{print $10}'|grep "False"|wc -l>>at.txt
np=$(sudo ./vol -f /home/ubuntu/"$memdump" --profile="${profiles[0]}" psxview |awk '{print $4}'|grep 'True'|wc -l);dll=$(sudo ./vol -f /home/ubuntu/"$memdump" --profile="${profiles[0]}" psxview |tail -n +3|wc -l);echo " $dll $np "|awk '{printf "%f\n",$2/$1}' >>at.txt
np=$(sudo ./vol -f /home/ubuntu/"$memdump" --profile="${profiles[0]}" psxview |awk '{print $2}'|grep -v '*'|wc -l);dll=$(sudo ./vol -f /home/ubuntu/"$memdump" --profile="${profiles[0]}" psxview |tail -n +3|wc -l);echo " $dll $np "|awk '{printf "%f\n",$2/$1}' >>at.txt
np=$(sudo ./vol -f /home/ubuntu/"$memdump" --profile="${profiles[0]}" psxview |awk '{print $6}'|grep 'True'|wc -l);dll=$(sudo ./vol -f /home/ubuntu/"$memdump" --profile="${profiles[0]}" psxview |tail -n +3|wc -l);echo " $dll $np "|awk '{printf "%f\n",$2/$1}' >>at.txt
np=$(sudo ./vol -f /home/ubuntu/"$memdump" --profile="${profiles[0]}" psxview |awk '{print $7}'|grep 'True'|wc -l);dll=$(sudo ./vol -f /home/ubuntu/"$memdump" --profile="${profiles[0]}" psxview |tail -n +3|wc -l);echo " $dll $np "|awk '{printf "%f\n",$2/$1}' >>at.txt
np=$(sudo ./vol -f /home/ubuntu/"$memdump" --profile="${profiles[0]}" psxview |awk '{print $8}'|grep 'True'|wc -l);dll=$(sudo ./vol -f /home/ubuntu/"$memdump" --profile="${profiles[0]}" psxview |tail -n +3|wc -l);echo " $dll $np "|awk '{printf "%f\n",$2/$1}' >>at.txt
np=$(sudo ./vol -f /home/ubuntu/"$memdump" --profile="${profiles[0]}" psxview |awk '{print $9}'|grep 'True'|wc -l);dll=$(sudo ./vol -f /home/ubuntu/"$memdump" --profile="${profiles[0]}" psxview |tail -n +3|wc -l);echo " $dll $np "|awk '{printf "%f\n",$2/$1}' >>at.txt
np=$(sudo ./vol -f /home/ubuntu/"$memdump" --profile="${profiles[0]}" psxview |awk '{print $10}'|grep 'True'|wc -l);dll=$(sudo ./vol -f /home/ubuntu/"$memdump" --profile="${profiles[0]}" psxview |tail -n +3|wc -l);echo " $dll $np "|awk '{printf "%f\n",$2/$1}' >>at.txt
sudo ./vol -f /home/ubuntu/"$memdump" --profile="${profiles[0]}" svcscan|grep 'Offset'|wc -l>>at.txt
sudo ./vol -f /home/ubuntu/"$memdump" --profile="${profiles[0]}" svcscan|grep 'KERNEL_DRIVER'|wc -l>>at.txt
sudo ./vol -f /home/ubuntu/"$memdump" --profile="${profiles[0]}" svcscan|grep 'OWN_PROCESS'|grep -v 'INTERACTIVE_PROCESS'|wc -l>>at.txt
sudo ./vol -f /home/ubuntu/"$memdump" --profile="${profiles[0]}" svcscan|grep 'SHARE_PROCESS'|wc -l>>at.txt
sudo ./vol -f /home/ubuntu/"$memdump" --profile="${profiles[0]}" svcscan|grep 'RUNNING'|wc -l>>at.txt
sudo ./vol -f /home/ubuntu/"$memdump" --profile="${profiles[0]}" svcscan|grep 'INTERACTIVE_PROCESS'|wc -l>>at.txt
sudo mv at.txt /home/ubuntu/volatility3
cd ..
cd volatility3
sudo python3 vol.py -f /home/ubuntu/"$memdump" windows.callbacks|tail -n +5|wc -l >>at.txt
sudo python3 vol.py -f /home/ubuntu/"$memdump" windows.callbacks|awk '$3 == "ntoskrnl" {print}'|wc -l>>at.txt
sudo mv at.txt /home/ubuntu/
cd ..
sudo mv at.txt modified.txt
aws s3 cp /home/ubuntu/modified.txt s3://divyareddybucket/attributes/modified.txt
